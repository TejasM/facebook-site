{% load staticfiles %}
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Benefit Cosmetics</title>
    <link rel="stylesheet" href="/static/css/main.css"/>
    <link href='http://fonts.googleapis.com/css?family=Englebert|Stalemate' rel='stylesheet' type='text/css'>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
</head>
<body onload='location.href="#app"'>
{% include 'header.html' %}
<div class="content" id="wrap">
    <a name="app"></a>

    <div id="overlay"
         style=" position: absolute; width: 100%; height: 100%; left: 0; top: 0; background: rgba(0, 0, 0, 0.8)"></div>
    <div class="email" style="position: absolute; top: 100px; display: none; width: 100%;">
        <div id="enter-to-win">
            <form action="/email/" method="post" id="email_form">
                {% csrf_token %}
                <input type="hidden" value="" name="user_id" id="user_id">
                <div class="first-name">
                    <input type="text" id="first_name" placeholder="First Name" name="first_name" />
                    <div id="firstNameMsg"></div>
                </div>
                <div class="last-name">
                    <input type="text" id="last_name" placeholder="Last Name" name="last_name" />
                    <div id="lastNameMsg"></div>
                </div>
                <div class="email-input">
                    <input type="text" id="email" placeholder="Email" name="email" />
                    <div id="emailMsg"></div>
                </div>
                <br>
                <div class="terms-check" style="text-align: center">
                    <input type="checkbox" id="terms" name="terms" style="margin-right: 10px">Hey gorgeous, donâ€™t forget
                    to agree to our <a
                        href="#">terms
                    and conditions!</a>
                    <div id="termsMsg"
                         style="color: white; background-color: pink; width: 85%; text-align: center; display: inline-block"></div>
                    {% if messages %}
                        {% for message in messages %}
                            <div id="errors"
                                 style="color: white; background-color: pink; width: 70%; text-align: center; display: inline-block">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                    <p>In order to continue, please like us on Facebook!</p>
                </div>

                <div style="text-align: center">
                    <img id="like-alternate" style="display: none; cursor: pointer;"
                         src="/static/images/like.png"/>
                    <img id="login" style="display: none; cursor: pointer;"
                         src="/static/images/like.png"/>
                </div>
                <div style="text-align: center; margin-top:20px; width: 80px; height: 27px;">
                    <div id="fb-root" style="text-align: center">
                        <div id="like-button" class="fb-like" data-width="450"
                             data-href="https://www.facebook.com/benefitcosmeticscanada"></div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="how" style="position: absolute; top: 100px; width: 100%;">
        <div style="margin: auto; width: 422px;">
            <img src="/static/images/Pinboard%20Assets/Text/how-to-play.png" alt="">

            <div style="text-align: center;"><img style="cursor: pointer;" src="/static/images/Pinboard%20Assets/Buttons/okay.png"
                                              alt="" class="close">
            </div>
        </div>
    </div>
</div>
{% include 'footer.html' %}
<script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
<script src="{% static 'js/jquery.lightbox_me.js' %}"></script>
<script type="text/javascript">
    function preventSubmission() {
        var $firstname = $('#first_name');
        var $lastname = $('#last_name');
        var $firstNameMsg = $('#firstNameMsg');
        var $lastNameMsg = $('#lastNameMsg');
        var $email = $('#email');
        var $emailMsg = $('#emailMsg');
        var $termsMsg = $('#termsMsg');
        $emailMsg.text('');
        $firstNameMsg.text('');
        $lastNameMsg.text('');
        $termsMsg.text('');
        var flag = false;
        if ($firstname.val() == '') {
            $firstNameMsg.text('Required');
            flag = true;
        }
        if ($lastname.val() == '') {
            $lastNameMsg.text('Required');
            flag = true;
        }
        if ($email.val() == '' || !validateEmail($email.val())) {
            $emailMsg.text('Please enter a valid email address');
            flag = true;
        }
        if (!$('#terms').is(":checked")) {
            $termsMsg.text('Please accept the terms and conditions to continue');
            flag = true;
        }
        if (flag == true) {
            event.preventDefault();
            return false;
        }
        return true;
    }
    function validateEmail(email) {
        var re = /\S+@\S+\.\S+/;
        return re.test(email);
    }

</script>
<script src="http://connect.facebook.net/en_US/all.js"></script>
<script>
    $(function () {
        var $how = $('.how');
        var $email = $('.email');
        $(".close").click(function () {
            $how.hide();
            $email.show();
        });
        var user_id = '';
        var $like = $('#like-alternate');
        $('#like-button').css("display", "none");
        // init the FB JS SDK
        FB.init({
            appId: '151985691672341',                        // App ID from the app dashboard
            cookie: true,
            status: true,                                 // Check Facebook Login status
            xfbml: true                                  // Look for social plugins on the page
        });

        FB.Event.subscribe('edge.create',
                function () {
                    if (preventSubmission()) {
                        $("#user_id").val(user_id);
                        $('#email_form').submit();
                    } else {
                        $('#like-alternate').css("display", "inline");
                    }
                }
        );
        FB.Event.subscribe('auth.authResponseChange', function (response) {
            // Here we specify what we do with the response anytime this event occurs.
            if (response.status === 'connected') {
                // The response object is returned with a status field that lets the app know the current
                // login status of the person. In this case, we're handling the situation where they
                // have logged in to the app.
                $('#login').hide();
                user_id = response.authResponse.userID;
                var page_id = "171685016222749"; //Change to this page
                FB.api({
                            method: 'fql.query',
                            query: 'SELECT uid FROM page_fan WHERE uid=' + user_id + 'AND page_id=' + page_id
                        }, function (resp) {
                            if (resp.length) {
                                $('#like-alternate').css("display", "inline");
                            } else {
                                $('#like-button').css("display", "inline");
                            }
                        }
                );
            } else if (response.status === 'not_authorized') {
                $('#login').css("display", "inline");
            } else {
                $('#login').css("display", "inline");
            }
        });

        $('#login').click(function () {
            if (preventSubmission()) {
                FB.login(function (response) {
                    $('#login').css("display", "none");
                    user_id = response.authResponse.userID;
                    var page_id = "171685016222749"; //Change to this page
                    FB.api({
                                method: 'fql.query',
                                query: 'SELECT uid FROM page_fan WHERE uid=' + user_id + 'AND page_id=' + page_id
                            }, function (resp) {
                                if (resp.length) {
                                    $("#user_id").val(user_id);
                                    $('#email_form').submit();
                                } else {
                                    var $like2 = $('#like-button');
                                    $like2.css("display", "inline");
                                    FB.XFBML.parse();
                                }
                            }
                    );
                }, {scope: 'user_likes,user_photos,publish_stream,photo_upload,friends_photos'});
                $('#login').hide();
            }
        });

        $like.click(function () {
            if (preventSubmission()) {
                $("#user_id").val(user_id);
                $('#email_form').submit();
            }
        });

        FB.getLoginStatus(function (response) {
            if (response.status === 'connected') {

            } else if (response.status === 'not_authorized') {
                $('#login').css("display", "inline");
            } else {
                $('#login').css("display", "inline");
            }
        });
    });
</script>
</body>
</html>